
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="css/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-old-ie-min.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="css/pure/0.6.0/grids-responsive-min.css">
        <!--<![endif]-->
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="/combo/1.18.13?/css/layouts/pricing-old-ie.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="css/style.css">
        <!--<![endif]-->
    <!--[if lt IE 9]>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js"></script>
        <![endif]-->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>

    <script type="text/javascript" src="js/jquery.spinner.min.js"></script>
    <script>
        var locations=[];
        var cityListSelected=[];
        var polygon;
        var selectedCityIndex=-1;
        var cityList=[{
            name: 'Bengaluru',
            cfCityName: "Bangalore"
        },{
            name: 'Chennai',
            cfCityName: "Chennai"
        },{
            name: 'Pune',
            cfCityName: "Pune"
        },{
            name: 'Mumbai',
            cfCityName: "Mumbai"
        },{
            name: 'Hyderabad',
            cfCityName: "Hyderabad"
        }
        ];   
        var infoWindow = new google.maps.InfoWindow({
            content: "<a href='#'' id='test' onclick='testClick()''>Click to see properties.</a>"
        });     
        function testClick(){
            var url="https://www.commonfloor.com/listing-search?search_intent=rent&page=1&city="+cityList[selectedCityIndex].cfCityName+
            "&use_pp=1&set_pp=1&fetch_max=1&number_of_children=2&page_size=20&polygon=1&mapBounds=";
            var ne=polygon.getBounds().getNorthEast();
            var sw=polygon.getBounds().getSouthWest();
            url+=sw.lat()+","+sw.lng()+","+ne.lat()+","+ne.lng();
            window.open(url);
        }
        function findCity(address){            
            var index=-1;
            cityList.forEach(function(city, ci){
                if(address.indexOf(city.name)>0) {
                    index=ci;
                }
            });
            return index;
        }
        function setAutoCompleteListener(autocomplete, index){
            google.maps.event.addListener(autocomplete, 'place_changed', function() {
                var place = autocomplete.getPlace();                
                if (!place.geometry) {
                    locations[index]=null;
                    cityListSelected[index]=null;
                    window.alert("Autocomplete's returned place contains no geometry");
                    return;
                }
                var cityIndex=findCity(place.formatted_address);
                locations[index]=place.geometry.location;
                cityListSelected[index]=cityIndex;
            });
        }
        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng(12.9539974,77.6268196),
                scrollwheel: false,
                zoom: 12,
                minZoom:12,
                maxZoom:16
            };
            var map = new google.maps.Map($('#map-canvas')[0], mapOptions);
            $('.controls.pac-input').each(function(index){
                locations.push(null);
                cityListSelected.push(null);
                var autoOptions = {
                    types: ["geocode"]
                };
                var autocomplete = new google.maps.places.Autocomplete($(this)[0]);
                setAutoCompleteListener(autocomplete, index);
            });
            $('.pure-button').click(function(){

                var params=$('.pac-input[data-rule="quantity"').map(function() {
                 return { distance: $(this).val()};
                }).get();                
                locations.forEach(function(item, index){
                    if(item) {                        
                        params[index].location={lat:item.lat(), lng:item.lng()};
                        params[index].cityIndex=cityListSelected[index]
                    }
                });    
                var skipNullLocations=function(obj){
                    return obj.location!=null;
                }
                var filtered=params.filter(skipNullLocations);
                if(filtered.length==0) {return;}
                selectedCityIndex=filtered[0].cityIndex;
                ga('send', '_trackEvent','Where_House', 'click', JSON.stringify(filtered));
                $.post( "/process", { params: filtered})
                  .done(function( data ) {
                    if(data){
                        var features=map.data.addGeoJson(data);
                        map.data.forEach(function(feature) {
                            processPoints(map, feature.getGeometry());
                        });
                        features.forEach(function(feature){
                            map.data.remove(feature);
                        })
                    } else {
                        alert("Sorry! you are a hard person to satisfy :)");
                        if(polygon) {
                            infoWindow.setMap(null);
                            polygon.setMap(null);
                        }
                    }
                });
            });
        }
        var polygon;
        if (!google.maps.Polygon.prototype.getBounds) {
          google.maps.Polygon.prototype.getBounds=function(){
              var bounds = new google.maps.LatLngBounds()
              this.getPath().forEach(function(element,index){bounds.extend(element)})
              return bounds;
          }
        }
        function processPoints(map, geometry) {
          var paths=[];
          geometry.getArray()[0].getArray().forEach(function(g) {
            paths.push(new google.maps.LatLng(g.lng(), g.lat()));
          });
          if(!polygon) {
              polygon=new google.maps.Polygon({
                map: map,
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.3
              }); 
            google.maps.event.addListener(polygon, 'mousemove', function(event){
                if(selectedCityIndex>=0)
                    infoWindow.setPosition(event.latLng);
                    infoWindow.open(map);
                }
            });
          }          
          polygon.setPath(paths);
          polygon.setMap(map);          
          map.fitBounds(polygon.getBounds());
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>
<body>
    <div class="pure-g">
        <div class="pure-u-1">
            <div class="pac-input"><B>Enter your points of interest e.g Office, Kids'School etc and how far from your house is acceptable &amp; We will tell you where you should be looking :-)</B></div>
        </div>
    </div>
    <div class="pure-g">
        <div class="pure-u-1 pure-u-md-1-2">
            <div class="pricing-tables pure-g">
                <div class="pure-u-1 pure-u-md-1-2">
                    <div class="pricing-table pricing-table-free">
                        <div class="pricing-table-header">
                            <input class="controls pac-input" type="text" placeholder="Enter a location">
                        </div>
                        <ul class="pricing-table-list">
                            <li class="pure-g">
                                <div class="input-append spinner pure-u-md-3-5  pure-u-md-2-3" data-trigger="spinner">
                                    <input style="margin:0px" type="text" class="pac-input" value="10" data-max="30" data-min="2" data-step="1" data-rule="quantity">
                                </div>
                                <div class="pure-u-md-1-5 pure-u-md-1-3" style="font-size: 2rem; ">KM</div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="pure-u-1 pure-u-md-1-2">
                    <div class="pricing-table pricing-table-biz pricing-table-selected">
                        <div class="pricing-table-header">
                            <input class="controls pac-input" type="text" placeholder="Enter a location">
                        </div>
                        <ul class="pricing-table-list">
                            <li class="pure-g">
                                <div class="input-append spinner pure-u-md-3-5 pure-u-md-2-3" data-trigger="spinner">
                                    <input style="margin:0px" type="text" class="pac-input" value="10" data-max="30" data-min="2" data-step="1" data-rule="quantity"  >
                                </div>
                                <div class="pure-u-md-1-5 pure-u-md-1-3" style="font-size: 2rem; ">KM</div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="pure-u-1 pure-u-md-1-2">
                    <div class="pricing-table pricing-table-enterprise">
                        <div class="pricing-table-header">
                            <input class="controls pac-input" type="text" placeholder="Enter a location">
                        </div>            
                        <ul class="pricing-table-list">
                            <li class="pure-g">
                                <div class="input-append spinner pure-u-md-3-5  pure-u-md-2-3" data-trigger="spinner">
                                    <input style="margin:0px" type="text" class="pac-input" value="10" data-max="30" data-min="2" data-step="1" data-rule="quantity"  >
                                </div>
                                <div class="pure-u-md-1-5 pure-u-md-1-3" style="font-size: 2rem; ">KM</div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="pure-u-1 pure-u-md-1-2">
                    <div class="pricing-table pricing-table-free">
                        <div class="pricing-table-header">
                            <input class="controls pac-input" type="text" placeholder="Enter a location">
                        </div>
                        <ul class="pricing-table-list">
                            <li class="pure-g">
                                <div class="input-append spinner pure-u-md-3-5 pure-u-md-2-3" data-trigger="spinner">
                                    <input style="margin:0px" type="text" class="pac-input" value="10" data-max="30" data-min="2" data-step="1" data-rule="quantity"  >
                                </div>
                                <div class="pure-u-md-1-5 pure-u-md-1-3" style="font-size: 2rem; ">KM</div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="pure-u-1 pure-u-md-1-2">
                    <div class="pricing-table pricing-table-biz pricing-table-selected">
                        <div class="pricing-table-header">
                            <input class="controls pac-input" type="text" placeholder="Enter a location">
                        </div>                
                        <ul class="pricing-table-list">
                            <li class="pure-g">
                                <div class="input-append spinner pure-u-md-3-5  pure-u-md-2-3" data-trigger="spinner">
                                    <input style="margin:0px" type="text" class="pac-input" value="10" data-max="30" data-min="2" data-step="1" data-rule="quantity"  >
                                </div>
                                <div class="pure-u-md-1-5 pure-u-md-1-3" style="font-size: 2rem;">KM</div>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="pure-u-1 pure-u-md-1-2">
                    <div class="pricing-table pricing-table-enterprise">
                        <div class="pricing-table-header">
                            <input class="controls pac-input" type="text" placeholder="Enter a location">
                        </div>
                        <ul class="pricing-table-list">
                            <li class="pure-g">
                                <div class="input-append spinner pure-u-md-3-5 pure-u-md-2-3" data-trigger="spinner">
                                    <input style="margin:0px" type="text" class="pac-input" value="10" data-max="30" data-min="2" data-step="1" data-rule="quantity"  >
                                </div>
                                <div class="pure-u-md-1-5 pure-u-md-1-3" style="font-size: 2rem; ">KM</div>
                            </li>
                        </ul>

                    </div>
                </div>
                <div class="pure-u-1">
                    <button class="button-choose pure-button">ENLIGHTEN ME!</button>
                </div>
            </div> 
        </div>
        <div class="pure-u-1 pure-u-md-1-2">
            <div class="pac-input"><B>FIND WHERE YOU SHOULD BE LOOKING FOR HOUSE</B></div>
            <div id="map-canvas" class="banner" height="600px"></div>
        </div>
    </div>
</body>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65964037-1', 'auto');
  ga('send', 'pageview');

</script>
</html>